{
    "#": "gi0.PINF.it/core/v0",

    "#": {
        "/.~/gi0.Sourcemint.org~sm.act/snapshots-activate": "sm.act.github.actions"
    },

    ":activate:": "/.~/gi0.Sourcemint.org~sm.act/snapshots-activate @ activate/v1",

    "gi0.PINF.it/build/v0 @ # :activate: build() /.~/gi0.Sourcemint.org~sm.act/snapshots-activate": {
        "onActivate": (javascript (require) >>>

            const FS = require("fs").promises;

            return async function (snapshot) {

                // Update README with snapshot details.

                let readme = await FS.readFile('../../README.md', 'utf8');
                let segments = readme.split('```');

                segments.forEach(function (segment, i) {

                    let replacement = null;

                    if (/^\nSM_ACT_REPO_GUID=/.test(segment)) {
                        replacement = Object.keys(snapshot.meta).map(function (name) {
                            return `SM_ACT_${name}=${snapshot.meta[name]}`;
                        }).join('\n');
                    } else
                    if (/^\n\{\n\s+"aspect":/.test(segment)) {
                        replacement = JSON.parse(JSON.stringify(snapshot));
                        replacement.env = {};
                        replacement = JSON.stringify(replacement, null, 5);
                    }

                    if (replacement) {
                        segments[i] = '\n' + replacement + '\n';
                    }
                });

                readme = segments.join('```');

                await FS.writeFile('../../README.md', readme, 'utf8');

                console.log("Updated 'README.md'.");
            }
        <<<)
    }
}